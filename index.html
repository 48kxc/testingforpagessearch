<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>48 Searcher</title>
  <style>
    /* [Insert your existing CSS styles here] */
    /* Ensure that elements like #accessPrompt, #adminPanel, and #container are styled appropriately */
  </style>
</head>
<body>

<!-- Access Prompt -->
<div id="accessPrompt">
  <input type="password" id="accessKeyInput" placeholder="Enter Access Key" />
  <button id="submitAccessKey">Submit</button>
  <p id="accessError" style="color: red;"></p>
</div>

<!-- Admin Panel Button -->
<button id="adminBtn" style="display: none;">Admin Panel</button>

<!-- Admin Panel Modal -->
<div id="adminPanel" style="display: none;">
  <input type="password" id="adminPassword" placeholder="Enter admin password" />
  <button id="loginAdmin">Login</button>
  <div id="keyGenerator" style="display: none;">
    <button id="generateKey">Generate Access Key</button>
    <p id="newKey"></p>
    <h3>Valid Keys</h3>
    <ul id="keyList"></ul>
  </div>
</div>

<!-- Main Container -->
<div id="container" style="display: none;">
  <h1>48 Searcher</h1>
  <input type="text" id="keywordInput" placeholder="Enter keywords" />
  <select id="domainSelect">
    <option value=".com">.com</option>
    <option value=".net">.net</option>
    <option value=".org">.org</option>
    <!-- Add more domain options as needed -->
  </select>
  <select id="operatorSelect">
    <option value="">None</option>
    <option value="site:">site:</option>
    <option value="inurl:">inurl:</option>
    <option value="intitle:">intitle:</option>
    <!-- Add more operators as needed -->
  </select>
  <button id="generateSearch">Generate Search Link</button>
  <p id="searchLink"></p>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    getDocs,
    query,
    where,
    Timestamp,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDkU4W01OimygxLlEXBhqrba3PglcV2224",
    authDomain: "searcher-key-sys.firebaseapp.com",
    projectId: "searcher-key-sys",
    storageBucket: "searcher-key-sys.appspot.com",
    messagingSenderId: "500491200168",
    appId: "1:500491200168:web:91ae88fa17f8a8bb6f849d"
  };

  const MASTER_KEY = "48ontop2323";

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const keysCollection = collection(db, "accessKeys");

  // Elements
  const accessPrompt = document.getElementById('accessPrompt');
  const accessKeyInput = document.getElementById('accessKeyInput');
  const submitAccessKey = document.getElementById('submitAccessKey');
  const accessError = document.getElementById('accessError');
  const container = document.getElementById('container');
  const adminBtn = document.getElementById('adminBtn');
  const adminPanel = document.getElementById('adminPanel');
  const adminPasswordInput = document.getElementById('adminPassword');
  const loginAdminBtn = document.getElementById('loginAdmin');
  const keyGeneratorDiv = document.getElementById('keyGenerator');
  const generateKeyBtn = document.getElementById('generateKey');
  const newKeyDisplay = document.getElementById('newKey');
  const keyList = document.getElementById('keyList');
  const keywordInput = document.getElementById('keywordInput');
  const domainSelect = document.getElementById('domainSelect');
  const operatorSelect = document.getElementById('operatorSelect');
  const generateSearchBtn = document.getElementById('generateSearch');
  const searchLink = document.getElementById('searchLink');

  // Access Control
  submitAccessKey.addEventListener('click', async () => {
    const enteredKey = accessKeyInput.value.trim();
    if (enteredKey === MASTER_KEY) {
      grantAccess();
      return;
    }

    const now = Timestamp.now();
    const q = query(keysCollection, where("key", "==", enteredKey), where("expireAt", ">", now));
    const querySnapshot = await getDocs(q);

    if (!querySnapshot.empty) {
      grantAccess();
    } else {
      accessError.textContent = "Invalid or expired key.";
    }
  });

  function grantAccess() {
    accessPrompt.style.display = 'none';
    container.style.display = 'block';
    adminBtn.style.display = 'block';
  }

  // Admin Panel
  adminBtn.addEventListener('click', () => {
    adminPanel.style.display = 'block';
    adminPasswordInput.value = '';
    keyGeneratorDiv.style.display = 'none';
    newKeyDisplay.textContent = '';
    keyList.innerHTML = '';
  });

  loginAdminBtn.addEventListener('click', async () => {
    const entered = adminPasswordInput.value.trim();
    if (entered === MASTER_KEY) {
      keyGeneratorDiv.style.display = 'block';
      await displayValidKeys();
    } else {
      alert('Wrong admin password!');
      keyGeneratorDiv.style.display = 'none';
      newKeyDisplay.textContent = '';
      keyList.innerHTML = '';
    }
  });

  // Generate a random key
  function generateRandomKey() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let key = '';
    for(let i=0; i<16; i++) {
      key += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return key;
  }

  generateKeyBtn.addEventListener('click', async () => {
    const newKey = generateRandomKey();
    const expireAt = Timestamp.fromDate(new Date(Date.now() + 7 * 3600 * 1000)); // 7 hours from now
    try {
      await addDoc(keysCollection, { key: newKey, expireAt, createdAt: serverTimestamp() });
      newKeyDisplay.textContent = `Generated key: ${newKey} (valid for 7 hours)`;
      await displayValidKeys();
    } catch (e) {
      alert('Error saving key: ' + e.message);
    }
  });

  async function displayValidKeys() {
    keyList.innerHTML = '';
    const now = Timestamp.now();
    const q = query(keysCollection, where("expireAt", ">", now));
    const querySnapshot = await getDocs(q);

    querySnapshot.forEach((doc) => {
      const data = doc.data();
      const li = document.createElement('li');
      const createdAt = data.createdAt?.toDate().toLocaleString() || 'N/A';
      const expireAt = data.expireAt.toDate().toLocaleString();
      li.textContent = `Key: ${data.key} | Created: ${createdAt} | Expires: ${expireAt}`;
      keyList.appendChild(li);
    });
  }

  // Search Functionality
  generateSearchBtn.addEventListener('click', () => {
    const keyword = encodeURIComponent(keywordInput.value.trim());
    const domain = domainSelect.value;
    const operator = operatorSelect.value;
    let query = '';

    if (operator) {
      query = `${operator}${domain} ${keyword}`;
    } else {
      query = `${keyword} ${domain}`;
    }

    const searchURL = `https://www.google.com/search?q=${query}`;
    searchLink.innerHTML = `<a href="${searchURL}" target="_blank">Search: ${searchURL}</a>`;
  });

</script>

</body>
</html>
