<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>48 Searcher with Access Keys and Admin Panel</title>
<style>
  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: Arial, sans-serif;
  }
  #accessKeyOverlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.9);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }
  #accessKeyOverlay input {
    padding: 8px;
    font-size: 16px;
  }
  #accessKeyOverlay button {
    padding: 8px 12px;
    margin-left: 8px;
    font-size: 16px;
  }
  #accessKeyError {
    color: red;
    margin-top: 10px;
    display: none;
  }
  #container {
    display: none;
    padding: 20px;
  }
  #adminBtn {
    position: fixed;
    top: 10px; right: 10px;
    padding: 8px 12px;
    background: #007bff;
    color: white;
    border: none;
    cursor: pointer;
    display: none; /* hidden initially */
    z-index: 10000;
  }
  #adminPanel {
    position: fixed;
    top: 50px; right: 10px;
    width: 400px;
    max-height: 80vh;
    overflow-y: auto;
    background: #f4f4f4;
    border: 1px solid #ccc;
    padding: 10px;
    display: none; /* hidden initially */
    z-index: 10001;
  }
  #keyGenerator, #keyList {
    margin-top: 10px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    border: 1px solid #aaa;
    padding: 5px;
    text-align: left;
  }
  label {
    display: block;
    margin-top: 10px;
  }
  input[type="text"], input[type="password"], textarea {
    width: 100%;
    box-sizing: border-box;
    padding: 6px;
  }
  button {
    cursor: pointer;
  }
</style>
</head>
<body>

<!-- Access Key Overlay -->
<div id="accessKeyOverlay">
  <h2>Please Enter Access Key</h2>
  <div>
    <input type="text" id="accessKeyInput" placeholder="Enter key here" />
    <button id="accessKeySubmit">Submit</button>
  </div>
  <div id="accessKeyError">Invalid or expired key. Please try again.</div>
</div>

<!-- Main Container -->
<div id="container">
  <h1>48 Searcher - Advanced Google Search Query Generator</h1>
  <label>
    Keywords (space separated):
    <input type="text" id="keywords" placeholder="e.g. cats dogs" />
  </label>
  <label>
    Exclude words (space separated):
    <input type="text" id="excludeWords" placeholder="e.g. fish bird" />
  </label>
  <label>
    Exact phrase:
    <input type="text" id="searchExact" placeholder="e.g. cute puppies" />
  </label>
  <label>
    Site or domain (e.g. site:.com or site:example.com):
    <input type="text" id="siteSearch" placeholder="e.g. .com or example.com" />
  </label>
  <label>
    Filetype (e.g. pdf, docx):
    <input type="text" id="fileType" placeholder="e.g. pdf" />
  </label>
  <label>
    intitle:
    <input type="text" id="intitle" placeholder="Search titles containing..." />
  </label>
  <label>
    inurl:
    <input type="text" id="inurl" placeholder="Search URLs containing..." />
  </label>
  <label>
    Exclude terms (space separated):
    <input type="text" id="excludeTerms" placeholder="e.g. blog news" />
  </label>
  <button id="generateBtn">Generate Search Query</button>
  <br/><br/>
  <textarea id="result" rows="6" readonly style="width: 100%;"></textarea>
</div>

<!-- Admin Button -->
<button id="adminBtn">Admin Panel</button>

<!-- Admin Panel -->
<div id="adminPanel">
  <h3>Admin Login</h3>
  <input type="password" id="adminPassword" placeholder="Enter admin password" />
  <button id="loginAdmin">Login</button>

  <div id="keyGenerator" style="display:none;">
    <h4>Generate New Access Key (7 hours expiry)</h4>
    <button id="generateKey">Generate Key</button>
    <p>New Key: <span id="newKey" style="font-family: monospace; font-weight: bold;"></span></p>
  </div>

  <div id="keyList" style="display:none;">
    <h4>Active Keys</h4>
    <table>
      <thead>
        <tr><th>Key</th><th>Created</th><th>Expires</th></tr>
      </thead>
      <tbody id="keyListBody"></tbody>
    </table>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    getDocs,
    query,
    where,
    deleteDoc,
    doc,
    serverTimestamp,
    Timestamp
  } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

  // Your Firebase config here
  const firebaseConfig = {
    apiKey: "AIzaSyDkU4W01OimygxLlEXBhqrba3PglcV2224",
    authDomain: "searcher-key-sys.firebaseapp.com",
    projectId: "searcher-key-sys",
    storageBucket: "searcher-key-sys.firebasestorage.app",
    messagingSenderId: "500491200168",
    appId: "1:500491200168:web:91ae88fa17f8a8bb6f849d"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const KEYS_COLLECTION = "accessKeys";
  const MASTER_KEY = "48ontop2323";
  const ADMIN_PASSWORD = "48ontop2323"; // change this to your secure admin password

  // Utility: generate random key
  function generateRandomKey(length = 12) {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let key = '';
    for (let i=0; i<length; i++) {
      key += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return key;
  }

  const adminBtn = document.getElementById('adminBtn');
  const adminPanel = document.getElementById('adminPanel');
  const loginAdminBtn = document.getElementById('loginAdmin');
  const adminPasswordInput = document.getElementById('adminPassword');
  const keyGeneratorDiv = document.getElementById('keyGenerator');
  const generateKeyBtn = document.getElementById('generateKey');
  const newKeyDisplay = document.getElementById('newKey');
  const keyListDiv = document.getElementById('keyList');
  const keyListBody = document.getElementById('keyListBody');

  let isAdminLoggedIn = false;

  // Access key UI elements
  const accessKeyOverlay = document.getElementById('accessKeyOverlay');
  const accessKeyInput = document.getElementById('accessKeyInput');
  const accessKeySubmit = document.getElementById('accessKeySubmit');
  const accessKeyError = document.getElementById('accessKeyError');
  const container = document.getElementById('container');

  async function fetchActiveKeys() {
    const now = Timestamp.now();
    const q = query(collection(db, KEYS_COLLECTION), where("expires", ">", now));
    const querySnapshot = await getDocs(q);
    const keys = [];
    querySnapshot.forEach(docSnap => {
      keys.push({ id: docSnap.id, ...docSnap.data() });
    });
    return keys;
  }

  async function addKeyToFirestore(key, expiresInHours = 7) {
    const expires = Timestamp.fromDate(new Date(Date.now() + expiresInHours * 3600 * 1000));
    await addDoc(collection(db, KEYS_COLLECTION), { key, created: serverTimestamp(), expires });
  }

  async function removeExpiredKeys() {
    const now = Timestamp.now();
    const q = query(collection(db, KEYS_COLLECTION), where("expires", "<=", now));
    const expired = await getDocs(q);
    expired.forEach(async docSnap => {
      await deleteDoc(doc(db, KEYS_COLLECTION, docSnap.id));
    });
  }

  async function validateAccessKey(key) {
    if (key === MASTER_KEY) return true;
    await removeExpiredKeys();
    const activeKeys = await fetchActiveKeys();
    return activeKeys.some(k => k.key === key);
  }

  async function loadAndDisplayKeys() {
    const activeKeys = await fetchActiveKeys();
    keyListBody.innerHTML = "";
    activeKeys.forEach(({ key, created, expires }) => {
      const createdDate = created ? created.toDate().toLocaleString() : 'N/A';
      const expiresDate = expires.toDate().toLocaleString();
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${key}</td><td>${createdDate}</td><td>${expiresDate}</td>`;
      keyListBody.appendChild(tr);
    });
  }

  // Admin login
  loginAdminBtn.onclick = async () => {
    if (adminPasswordInput.value === ADMIN_PASSWORD) {
      isAdminLoggedIn = true;
      adminPasswordInput.value = '';
      adminPasswordInput.style.display = 'none';
      loginAdminBtn.style.display = 'none';
      keyGeneratorDiv.style.display = 'block';
      keyListDiv.style.display = 'block';
      adminBtn.style.display = 'inline-block';
      await loadAndDisplayKeys();
    } else {
      alert('Incorrect admin password');
    }
  };

  // Toggle admin panel visibility
  adminBtn.onclick = () => {
    adminPanel.style.display = adminPanel.style.display === 'none' || adminPanel.style.display === '' ? 'block' : 'none';
  };

  // Generate new key
  generateKeyBtn.onclick = async () => {
    const newKey = generateRandomKey(14);
    await addKeyToFirestore(newKey);
    newKeyDisplay.textContent = newKey;
    await loadAndDisplayKeys();
  };

  // Access key submission
  accessKeySubmit.onclick = async () => {
    const key = accessKeyInput.value.trim();
    if (!key) return;
    accessKeyError.style.display = 'none';
    const valid = await validateAccessKey(key);
    if (valid) {
      accessKeyOverlay.style.display = 'none';
      container.style.display = 'block';
    } else {
      accessKeyError.style.display = 'block';
    }
  };

  accessKeyInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') accessKeySubmit.click();
  });

  // 48 Searcher main logic
  const keywordsInput = document.getElementById('keywords');
  const excludeWordsInput = document.getElementById('excludeWords');
  const siteSearchInput = document.getElementById('siteSearch');
  const fileTypeInput = document.getElementById('fileType');
  const searchExactInput = document.getElementById('searchExact');
  const intitleInput = document.getElementById('intitle');
  const inurlInput = document.getElementById('inurl');
  const excludeTermsInput = document.getElementById('excludeTerms');
  const generateBtn = document.getElementById('generateBtn');
  const resultTextarea = document.getElementById('result');

  generateBtn.onclick = () => {
    let queryParts = [];

    // Keywords
    let keywords = keywordsInput.value.trim().split(/\s+/).filter(Boolean);
    let excludeWords = excludeWordsInput.value.trim().split(/\s+/).filter(Boolean);
    keywords = keywords.filter(w => !excludeWords.includes(w));
    if (keywords.length) {
      queryParts.push(keywords.map(w => `"${w}"`).join(' '));
    }

    // Exact phrase
    const exact = searchExactInput.value.trim();
    if (exact) {
      queryParts.push(`"${exact}"`);
    }

    // site:
    const site = siteSearchInput.value.trim();
    if (site) {
      if (site.startsWith('.')) {
        queryParts.push(`site:${site}`);
      } else if (site.includes('.')) {
        queryParts.push(`site:${site}`);
      }
    }

    // filetype:
    const filetype = fileTypeInput.value.trim();
    if (filetype) {
      queryParts.push(`filetype:${filetype}`);
    }

    // intitle:
    const intitle = intitleInput.value.trim();
    if (intitle) {
      queryParts.push(`intitle:${intitle}`);
    }

    // inurl:
    const inurl = inurlInput.value.trim();
    if (inurl) {
      queryParts.push(`inurl:${inurl}`);
    }

    // Exclude terms
    let excludeTerms = excludeTermsInput.value.trim().split(/\s+/).filter(Boolean);
    excludeTerms.forEach(term => {
      queryParts.push(`-${term}`);
    });

    // Compose final query
    const finalQuery = queryParts.join(' ');
    resultTextarea.value = finalQuery;
  };
</script>

</body>
</html>
